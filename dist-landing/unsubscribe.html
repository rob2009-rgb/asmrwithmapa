<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unsubscribe â€” ASMR with MAPA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .serif {
            font-family: 'Playfair Display', serif;
        }
    </style>
</head>

<body class="selection:bg-pink-500/30 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full px-6 py-12 text-center">
        <header class="mb-12">
            <a href="/" class="inline-flex items-center gap-3 mb-8 group">
                <img src="/logo.jpg" alt="Logo" class="w-16 h-16 rounded-3xl border border-white/10 shadow-2xl" />
            </a>
            <h1 id="title" class="text-3xl font-bold mb-4">Unsubscribing...</h1>
            <p id="status-text" class="text-slate-400">Please wait while we process your request.</p>
        </header>

        <div id="loader" class="flex justify-center mb-8">
            <div class="w-10 h-10 border-4 border-pink-500/30 border-t-pink-500 rounded-full animate-spin"></div>
        </div>

        <div id="success-view" class="hidden">
            <div
                class="inline-flex items-center justify-center w-16 h-16 bg-green-500/10 text-green-500 rounded-full mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <p class="text-lg mb-8">You have been successfully removed from our list. We're sorry to see you go!</p>
            <a href="/"
                class="inline-block px-8 py-4 bg-white/5 border border-white/10 rounded-2xl text-sm font-bold hover:bg-white/10 transition-all">
                Return to the Sanctuary
            </a>
        </div>

        <div id="error-view" class="hidden text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-500/10 text-red-400 rounded-full mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </div>
            <p id="error-msg" class="text-lg text-slate-300 mb-8">Something went wrong. The link might be expired or
                invalid.</p>
            <a href="mailto:hello@asmrwithmapa.com" class="text-pink-400 hover:text-pink-300 text-sm font-bold">Contact
                Support</a>
        </div>
    </div>

    <script>
        async function handleUnsubscribe() {
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token');

            const title = document.getElementById('title');
            const statusText = document.getElementById('status-text');
            const loader = document.getElementById('loader');
            const successView = document.getElementById('success-view');
            const errorView = document.getElementById('error-view');
            const errorMsg = document.getElementById('error-msg');

            if (!token) {
                loader.classList.add('hidden');
                errorView.classList.remove('hidden');
                title.innerText = 'Invalid Link';
                errorMsg.innerText = 'No unsubscribe token found in the URL.';
                return;
            }

            try {
                // UPDATE THIS URL to your actual Edge Function URL or use relative /functions/
                // For Supabase Edge Functions on custom domains, it's usually https://project.supabase.co/functions/v1/...
                // But since we are on the same domain or using redirects, we can try to call it via the Supabase URL.
                // For simplicity, I'll use the placeholder and assume the user will deploy it.
                const SUPABASE_URL = 'https://cntiqdbfclkytbxrilii.supabase.co';

                const response = await fetch(`${SUPABASE_URL}/functions/v1/landing-unsubscribe?token=${token}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                loader.classList.add('hidden');
                if (response.ok) {
                    title.innerText = 'Success';
                    statusText.classList.add('hidden');
                    successView.classList.remove('hidden');
                } else {
                    title.innerText = 'Error';
                    errorView.classList.remove('hidden');
                    errorMsg.innerText = result.error || 'Failed to unsubscribe.';
                }
            } catch (err) {
                loader.classList.add('hidden');
                errorView.classList.remove('hidden');
                title.innerText = 'Connection Error';
                errorMsg.innerText = 'Could not reach our servers. Please try again later.';
            }
        }

        handleUnsubscribe();
    </script>
</body>

</html>